(this["webpackJsonpbrowser-testbench"]=this["webpackJsonpbrowser-testbench"]||[]).push([[0],{10:function(e,t,n){},11:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n.n(r),s=n(3),o=n.n(s),i=n(0);function l(e,t){return(""+t).padStart(e,"0")}function a(){let e=new Date;return"".concat(e.getHours(),":").concat(l(2,e.getMinutes()),":").concat(l(2,e.getSeconds()),".").concat(l(3,e.getMilliseconds()))}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t="";for(let n=0;n<e;n++)t+="1234567891"[Math.floor(9*Math.random())];return t}function u(e){let{children:t}=e;return Object(i.jsx)("div",{className:"log-viewer",children:t.map(((e,t)=>{let[n,r]=e;return Object(i.jsx)("pre",{className:"log-line log-line-"+r,children:Object(i.jsx)("code",{children:n})},t)}))})}function h(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{let r=t();r&&"function"===typeof r.catch&&r.catch((t=>{console.warn(t),n&&n(t)||(e.log(""+t,"error"),e.done(!1))}))}catch(r){console.warn(r),e.log(""+r,"error"),e.done(!1)}}function b(e,t){if(!e)throw new Error(t)}function j(e,t){let n=[];for(let r=e;r<t;r++)n.push(r);return n}function g(e){let{src:t,onLoad:n,onError:c,bench:s}=e,[o,l]=Object(r.useState)(!0),[a,u]=Object(r.useState)(null);return Object(r.useEffect)((()=>{h(s,(async()=>{let e=d(),n=await fetch(t,{headers:{"x-cache-key":e}});u(URL.createObjectURL(await n.blob())),l(!1)}))}),[s,t]),Object(r.useEffect)((()=>()=>{a&&URL.revokeObjectURL(a)}),[a]),o?"loading...":Object(i.jsx)("img",{src:a,onLoad:n,onError:c,alt:"img"})}async function p(e){let t=d(),n=await fetch("/cgi-bin/setblock?"+t+","+(e?1:0));b(200===n.status,"setblock failed with status "+n.status);let r=await n.text();b("ok"===r,"setblock failed with text "+r)}async function x(e){return new Promise((t=>{setTimeout(t,e)}))}const O={Running:"running",Passed:"passed",Failed:"failed",Unknown:"unknown"};const f=30;const m=[["proxy-sancheck",function(e){let{bench:t}=e;return Object(r.useEffect)((()=>{h(t,(async()=>{let e=d(),n="/cgi-bin/pingpong?"+e;t.log("requesting "+n);let r=await fetch(n,{mode:"same-origin",headers:{"X-Louder":"You're my everything"}});t.log("status code = "+r.status+" "+r.statusText),b(200===r.status,"bad status code, should be 200");let c=!1;for(let[o,i]of r.headers)t.log("response headers = "+o+": "+i,"debug"),"server"===o.toLowerCase()&&"tiny web server"===i.toLowerCase()&&(c=!0);b(c,'expecting "server: tiny web server" in response header. your proxy should pass all response headers to client!');let s=await r.text();t.log("response body = "+s,"debug"),b(-1!==s.toLowerCase().indexOf("this is ping-pong service."),'expecting "this is ping-pong service." in body'),b(-1!==s.toLowerCase().indexOf("your query string: "+e),'expecting "Your query string: xxxxxxxx" in body'),b(-1!==s.toLowerCase().replace(/\s/g,"").indexOf("x-louder:you'remyeverything"),"expecting correct X-Louder in body. your proxy should pass all request headers to server!"),b(-1!==s.toLowerCase().indexOf("gecko/20120305 firefox/10.0.3"),"expecting correct User-Agent in body. your proxy should use the string provided in writeup!"),t.done(!0)}))}),[t]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Proxy Sanity Check"}),Object(i.jsxs)("p",{children:["In this test, we request ",Object(i.jsx)("code",{children:"/cgi-bin/pingpong"})," and do basic sanity checks on the HTTP response."]}),Object(i.jsx)("p",{children:"If you fail this test, please make sure:"}),Object(i.jsxs)("ul",{children:[Object(i.jsx)("li",{children:"This webpage is hosted by TINY server provided in your handout."}),Object(i.jsx)("li",{children:"You are browsing this page through your proxy (some browsers ignore proxy settings for localhost URL)."}),Object(i.jsxs)("li",{children:["Your proxy sends the correct ",Object(i.jsx)("code",{children:"User-Agent"})," header as described in writeup."]})]})]})},2],["proxy-resource-type",function(e){let{bench:t}=e,[n,c]=Object(r.useState)((()=>d())),[s,o]=Object(r.useState)(0),l=Object(r.useRef)(null),a=Object(r.useRef)(null),u=Object(r.useRef)(null),j=Object(r.useRef)(null);function g(e){t.log("failed to load ".concat(e),"error"),t.done(!1)}return Object(r.useEffect)((()=>{t.log("URL arg is ?"+n,"debug")}),[n]),Object(r.useEffect)((()=>{4===s&&t.done(!0)}),[t,s]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Proxy Resource Type Check"}),Object(i.jsx)("p",{children:"In this test, we request 1) a short Unicode text file, 2) a longer (500KB) text file, 3) an image and 4) an MP3 audio from the server."}),Object(i.jsx)("p",{children:"Your proxy should handle them correctly."}),Object(i.jsxs)("p",{children:["Note that HTTP responses may not have a ",Object(i.jsx)("code",{children:"Content-Length"})," header."]}),Object(i.jsxs)("p",{children:["Status: Loaded ",s," of them."]}),Object(i.jsx)("p",{children:"1)"}),Object(i.jsx)("iframe",{ref:l,title:"short text",src:"/cgi-bin/forwarder?"+n+",test_files/text.txt,text/plain;charset=utf-8",onLoad:function(){t.log("loaded text short"),h(t,(()=>{b(l.current.contentDocument,"cannot get loaded document");let e=l.current.contentDocument.body.textContent;t.log("text short: "+e,"debug"),b(-1!==e.indexOf("\u5317\u4eac\u5927\u5b66"),"text short incorrect"),o((e=>e+1))}))},onError:()=>g("short text")}),Object(i.jsx)("p",{children:"2)"}),Object(i.jsx)("iframe",{ref:a,title:"long text",src:"/cgi-bin/repeater?"+n+",50000,LoremIpsum,0",onLoad:function(){t.log("loaded text long"),h(t,(()=>{b(a.current.contentDocument,"cannot get loaded document");let e=a.current.contentDocument.body.textContent;t.log("text long: "+e.substr(0,30)+"... length="+e.length,"debug"),b("LoremIpsumLoremIpsumLoremIpsum"===e.substr(0,30)&&5e5===e.length,"text long incorrect"),o((e=>e+1))}))},onError:()=>g("long text")}),Object(i.jsx)("p",{children:"3)"}),Object(i.jsx)("img",{ref:u,alt:"img",src:"/cgi-bin/forwarder?"+n+",test_files/cornell-box.png,image/png",onLoad:function(){t.log("loaded image"),h(t,(()=>{t.log("image dimension: "+u.current.naturalWidth+"*"+u.current.naturalHeight,"debug"),b(300===u.current.naturalHeight&&300===u.current.naturalWidth,"image incorrect"),o((e=>e+1))}))},onError:()=>g("image")}),Object(i.jsx)("p",{children:"4)"}),Object(i.jsx)("audio",{ref:j,muted:!0,autoPlay:!0,controls:!0,src:"/cgi-bin/forwarder?"+n+",test_files/ki-ringtone-mono.mp3,audio/mp3",onCanPlay:function(){t.log("loaded mp3"),h(t,(()=>{t.log("mp3 duration: "+j.current.duration,"debug"),b(j.current.duration>21&&j.current.duration<22,"mp3 incorrect"),o((e=>e+1))}))},onError:()=>g("mp3")})]})},3],["proxy-speed",function(e){let{bench:t}=e,[n,c]=Object(r.useState)(0);return Object(r.useEffect)((()=>{h(t,(async()=>{for(let e=1;e<=100;e++){let n=d();t.log("request #"+e+": URL arg ?"+n,"debug");let r=await fetch("/cgi-bin/pingpong?"+n);b(200===r.status,"in request #"+e+": status code is "+r.status+", expecting 200");let c=await r.text();b(-1!==c.indexOf("ping-pong service"),"in request #"+e+": incorrect body: "+c)}t.done(!0)}))}),[t]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Proxy Speed Check"}),Object(i.jsx)("p",{children:"In this test, we fire 100 requests sequentially. Your proxy should get this work done quickly."})]})},4],["real-csapp",function(e){let{bench:t}=e;return Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Real Page CSAPP Check"}),Object(i.jsx)("p",{children:"The homepage of CSAPP book is a simple webpage. Hopefully your proxy can handle it."}),Object(i.jsx)("iframe",{src:"/test_files/csapp_3e/home.html",onLoad:function(e){h(t,(async()=>{b(e.target.contentDocument,"cannot get loaded document");let n=e.target.contentDocument.title;t.log("iframe loaded, title = "+n),b(-1!==n.indexOf("CS:APP"),'title should contains "CS:APP"');let r=Array.from(e.target.contentDocument.querySelectorAll("img"));b(1===r.length,"should have exactly one image on the webpage, but found "+r.length),t.done(!0)}))},onError:function(e){t.log("iframe failed to load","error"),t.done(!1)},style:{height:"500px",width:"600px",maxWidth:"unset"}})]})},3],["cache-concurrent",function(e){let{bench:t}=e,[n,c]=Object(r.useState)(0),[s,o]=Object(r.useState)(0),[l,a]=Object(r.useState)((()=>j(0,10).map((()=>-d()))));function u(e){e===n&&o((e=>e+1))}function b(e){t.log("failed at step "+e,"error"),h(t,(()=>p(!1))),t.done(!1)}return Object(r.useEffect)((()=>{t.log("step "+n),h(t,(async()=>{0===n?(await p(!1),t.log("URL args for step 1 and step 3: "+JSON.stringify(l.slice(0,5)),"debug"),t.log("URL args for step 4: "+JSON.stringify(l.slice(5)),"debug"),o(0),c(1)):2===n?(await p(!0),o(0),c(3)):5===n&&(await p(!1),t.done(!0))}))}),[t,n]),Object(r.useEffect)((()=>{1===n&&15===s?(o(0),c(2)):3===n&&15===s?(o(0),c(4)):4===n&&15===s&&(o(0),c(5))}),[n,s]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Cache Concurrency Check"}),Object(i.jsx)("p",{children:"In this test, we check the caching functionality of your proxy by these steps:"}),Object(i.jsxs)("ol",{children:[Object(i.jsxs)("li",{children:["Load ",5," images with different URL. Each image will be loaded ",3," times."]}),Object(i.jsx)("li",{children:"Tell TINY to stop responding to new requests."}),Object(i.jsxs)("li",{children:["Load these images again. Each image will be loaded ",3," times and they should be served by your proxy."]}),Object(i.jsxs)("li",{children:["Load ",5," new images, ",3," times each. These requests should fail because TINY has stopped responding."]}),Object(i.jsx)("li",{children:"Done :)"})]}),Object(i.jsxs)("p",{children:["Status: We are on step ",n," now."]}),Object(i.jsx)("table",{border:"1",children:Object(i.jsxs)("tbody",{children:[n>=1&&Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"URL"}),j(0,5).map((e=>Object(i.jsx)("td",{children:Object(i.jsxs)("a",{href:"/cgi-bin/forwarder?"+l[e]+",test_files/cornell-box.png,image/png",target:"_blank",children:["?",l[e]]})},e)))]}),j(0,3).map((e=>Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"Step 1"}),j(0,5).map((e=>Object(i.jsx)("td",{children:Object(i.jsx)(g,{bench:t,src:"/cgi-bin/forwarder?"+l[e]+",test_files/cornell-box.png,image/png",onLoad:()=>u(1),onError:()=>b(1)})},e)))]},e)))]}),n>=3&&j(0,3).map((e=>Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"Step 3"}),j(0,5).map((e=>Object(i.jsx)("td",{children:Object(i.jsx)(g,{bench:t,src:"/cgi-bin/forwarder?"+l[e]+",test_files/cornell-box.png,image/png",onLoad:()=>u(3),onError:()=>b(3)})},e)))]},e))),n>=4&&Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"URL"}),j(0,5).map((e=>Object(i.jsx)("td",{children:Object(i.jsxs)("a",{href:"/cgi-bin/forwarder?"+l[5+e]+",test_files/cornell-box.png,image/png",target:"_blank",children:["?",l[5+e]]})},e)))]}),j(0,3).map((e=>Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"Step 4"}),j(0,5).map((e=>Object(i.jsx)("td",{children:Object(i.jsx)(g,{bench:t,src:"/cgi-bin/forwarder?"+l[5+e]+",test_files/cornell-box.png,image/png",onError:()=>u(4),onLoad:()=>b(4)})},e)))]},e)))]})]})})]})},5],["cache-lru",function(e){let{bench:t}=e,[n,c]=Object(r.useState)(0),[s,o]=Object(r.useState)(0),[l,a]=Object(r.useState)((()=>j(0,f).map((()=>-d()))));function u(e){e===n&&o((e=>e+1))}function b(e){t.log("failed at step "+e,"error"),h(t,(()=>p(!1))),t.done(!1)}return Object(r.useEffect)((()=>{t.log("step "+n),h(t,(async()=>{0===n?(await p(!1),t.log("URL args for each image: "+JSON.stringify(l),"debug"),o(0),c(1)):2===n?(await p(!0),o(0),c(3)):5===n&&(await p(!1),t.done(!0))}))}),[t,n]),Object(r.useEffect)((()=>{1===n&&s===f?(o(0),c(2)):3===n&&3===s?(o(0),c(4)):4===n&&3===s&&(o(0),c(5))}),[n,s]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Cache LRU Check"}),Object(i.jsx)("p",{children:"In this test, we check the LRU nature of your caching proxy by these steps:"}),Object(i.jsxs)("ol",{children:[Object(i.jsxs)("li",{children:["Load images #0 ~ #",29," in a nearly sequential manner. Each image is of 50KB large so it should be added into cache."]}),Object(i.jsx)("li",{children:"Tell TINY to stop responding to new requests."}),Object(i.jsxs)("li",{children:["Load images #",27," ~ #",29," again. They should be served by your proxy."]}),Object(i.jsxs)("li",{children:["Load images #0 ~ #",2,". They should be evicted from cache; therefore these requests will fail."]}),Object(i.jsx)("li",{children:"Done :)"})]}),Object(i.jsxs)("p",{children:["We are on step ",n," now."]}),n>=1&&Object(i.jsxs)("div",{children:[Object(i.jsx)("h2",{children:"Step 1"}),Object(i.jsx)("p",{children:j(0,1===n?Math.min(s+2,f):f).map((e=>Object(i.jsxs)("span",{style:{display:"inline-block"},children:[Object(i.jsxs)("p",{children:["Image #",e," \u2193"]}),Object(i.jsx)("p",{children:Object(i.jsx)(g,{bench:t,src:"/cgi-bin/forwarder?"+l[e]+",test_files/cornell-box.png,image/png",onLoad:()=>u(1),onError:()=>b(1)})})]},e)))})]}),n>=3&&Object(i.jsxs)("div",{children:[Object(i.jsx)("h2",{children:"Step 3"}),Object(i.jsx)("p",{children:j(27,f).map((e=>Object(i.jsxs)("span",{style:{display:"inline-block"},children:[Object(i.jsxs)("p",{children:["Image #",e," \u2193"]}),Object(i.jsx)("p",{children:Object(i.jsx)(g,{bench:t,src:"/cgi-bin/forwarder?"+l[e]+",test_files/cornell-box.png,image/png",onLoad:()=>u(3),onError:()=>b(3)})})]},e)))})]}),n>=4&&Object(i.jsxs)("div",{children:[Object(i.jsx)("h2",{children:"Step 4"}),Object(i.jsx)("p",{children:j(0,3).map((e=>Object(i.jsxs)("span",{style:{display:"inline-block"},children:[Object(i.jsxs)("p",{children:["Image #",e," \u2193"]}),Object(i.jsx)("p",{children:Object(i.jsx)(g,{bench:t,src:"/cgi-bin/forwarder?"+l[e]+",test_files/cornell-box.png,image/png",onError:()=>u(4),onLoad:()=>b(4)})})]},e)))})]})]})},5],["robust-concurrent",function(e){let{bench:t}=e,[n,c]=Object(r.useState)((()=>function(){let e=j(0,10).map((()=>d()));return t.log("URL args for each row: "+JSON.stringify(e),"debug"),e}())),[s,o]=Object(r.useState)(0);function l(e,n){t.log("failed to load ".concat(n," on row ").concat(e),"error"),t.done(!1)}return Object(r.useEffect)((()=>{40===s&&t.done(!0)}),[t,s]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Robust Concurrency Check"}),Object(i.jsxs)("p",{children:["In this test, we load all 4 files described in ",Object(i.jsx)("code",{children:"proxy-resource-type"}),", ",10," times each."]}),Object(i.jsx)("p",{children:"It should be easy to pass this test unless your proxy crashes."}),Object(i.jsxs)("p",{children:["Status: Loaded ",s," of them."]}),Object(i.jsxs)("table",{children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{children:"#"}),Object(i.jsx)("th",{children:"text (short)"}),Object(i.jsx)("th",{children:"text (long)"}),Object(i.jsx)("th",{children:"image"}),Object(i.jsx)("th",{children:"MP3"})]})}),Object(i.jsx)("tbody",{children:j(0,10).map((e=>Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:e+1}),Object(i.jsx)("td",{children:Object(i.jsx)("iframe",{title:"short text",src:"/cgi-bin/forwarder?"+n[e]+",test_files/text.txt,text/plain;charset=utf-8",onLoad:n=>function(e,n){t.log("loaded text short on row "+e),h(t,(()=>{b(n.target.contentDocument,"cannot get loaded document");let e=n.target.contentDocument.body.textContent;t.log("text short: "+e,"debug"),b(-1!==e.indexOf("\u5317\u4eac\u5927\u5b66"),"text short incorrect"),o((e=>e+1))}))}(e+1,n),onError:()=>l(e+1,"short text")})}),Object(i.jsx)("td",{children:Object(i.jsx)("iframe",{title:"long text",src:"/cgi-bin/repeater?"+n[e]+",6000,LoremIpsumLoremIpsum,0",onLoad:n=>function(e,n){t.log("loaded text long on row "+e),h(t,(()=>{let e=n.target.contentDocument.body.textContent;t.log("text long: "+e.substr(0,30)+"... length="+e.length,"debug"),b("LoremIpsumLoremIpsumLoremIpsum"===e.substr(0,30)&&12e4===e.length,"text long incorrect"),o((e=>e+1))}))}(e+1,n),onError:()=>l(e+1,"long text")})}),Object(i.jsx)("td",{children:Object(i.jsx)("img",{alt:"img",src:"/cgi-bin/forwarder?"+n[e]+",test_files/cornell-box.png,image/png",onLoad:n=>function(e,n){t.log("loaded image on row "+e),h(t,(()=>{t.log("image dimension: "+n.target.naturalWidth+"*"+n.target.naturalHeight,"debug"),b(300===n.target.naturalHeight&&300===n.target.naturalWidth,"image incorrect"),o((e=>e+1))}))}(e+1,n),onError:()=>l(e+1,"image")})}),Object(i.jsx)("td",{children:Object(i.jsx)("audio",{muted:!0,autoPlay:!0,controls:!0,src:"/cgi-bin/forwarder?"+n[e]+",test_files/ki-ringtone-mono.mp3,audio/mp3",onCanPlay:n=>function(e,n){t.log("loaded mp3 on row "+e),h(t,(()=>{t.log("mp3 duration: "+n.target.duration,"debug"),n.target.pause(),b(n.target.duration>21&&n.target.duration<22,"mp3 incorrect"),o((e=>e+1))}))}(e+1,n),onError:()=>l(e+1,"mp3")})})]},e)))})]})]})},8],["robust-bad-request",function(e){let{bench:t}=e;return Object(r.useEffect)((()=>{h(t,(async()=>{t.log("1. POST http://pkunews.pku.edu.cn/"),fetch("http://pkunews.pku.edu.cn/",{method:"post",mode:"no-cors"}),await x(100),t.log("2. HEAD http://pkunews.pku.edu.cn/"),fetch("http://pkunews.pku.edu.cn/",{method:"head",mode:"no-cors"}),await x(100),t.log("3. GET https://pkunews.pku.edu.cn/"),fetch("https://pkunews.pku.edu.cn/",{mode:"no-cors"}),await x(100),t.log("4. GET http://127.0.0.1.nip.io:65432/"),fetch("http://127.0.0.1.nip.io:65432/",{mode:"no-cors"}),await x(100),t.log("5. GET http://maruyama.pico/"),fetch("http://maruyama.pico/",{mode:"no-cors"}),await x(100),t.log("6. GET http://pkunews.pku.edu.cn/LoremIpsum..."),fetch("http://pkunews.pku.edu.cn/"+function(e,t){let n="";for(;t--;)n+=e;return n}("LoremIpsum",3200),{mode:"no-cors"}),await x(100),t.log("We will check if the proxy is still working after 2s"),await x(1900);let e=d();t.log("Finally, GET /cgi-bin/pingpong?"+e);let n=await fetch("/cgi-bin/pingpong?"+e,{mode:"same-origin"});t.log("status code = "+n.status+" "+n.statusText),b(200===n.status,"bad status code, should be 200");let r=await n.text();t.log("response body = "+r,"debug"),b(-1!==r.toLowerCase().indexOf("this is ping-pong service."),'expecting "this is ping-pong service." in body'),t.done(!0)}))}),[t]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Robust Bad Request Check"}),Object(i.jsx)("p",{children:"In this test we make requests that your proxy might not recognize, in particular:"}),Object(i.jsxs)("ol",{children:[Object(i.jsx)("li",{children:"an HTTP request with POST method"}),Object(i.jsx)("li",{children:"an HTTP request with HEAD method"}),Object(i.jsx)("li",{children:"an HTTPS request (your proxy may receive an HTTP request with CONNECT method)"}),Object(i.jsx)("li",{children:"an HTTP request to a host that cannot be connected to"}),Object(i.jsx)("li",{children:"an HTTP request to a host that does not exist"}),Object(i.jsx)("li",{children:"an HTTP request with very long (32KB) URL"})]}),Object(i.jsx)("p",{children:"It is perfectly fine not to support them (except for HTTPS requests), but your proxy should not crash because of those requests."})]})},4],["robust-stream",function(e){let{bench:t}=e,[n,c]=Object(r.useState)(0),[s,o]=Object(r.useState)(0),[l,a]=Object(r.useState)((()=>function(){let e=j(0,4).map((()=>d()));return t.log("URL args for time-consuming requests: "+JSON.stringify(e.slice(0,2)),"debug"),t.log("URL args for time-consuming requests after 1s: "+JSON.stringify(e.slice(2)),"debug"),e}())),[u,g]=Object(r.useState)(!1);return Object(r.useEffect)((()=>{n<5&&h(t,(async()=>{await x(900);let e=d(8);t.log("pinging server #"+(n+1)+", URL arg ?"+e);let r=await Promise.race([fetch("/cgi-bin/pingpong?"+e),new Promise(((e,t)=>{setTimeout((()=>t(new Error("ping request timeout (1s)"))),1e3)}))]);b(200===r.status,"status code = "+r.status+", should be 200");let s=await r.text();b(-1!==s.toLowerCase().indexOf("this is ping-pong service."),"server respondeded: "+s),b(-1!==s.toLowerCase().indexOf(e),"server did not return correct serial: "+s),t.log("passed check","debug"),c(n+1)}),(()=>!1))}),[t,n]),Object(r.useEffect)((()=>{setTimeout((()=>{t.log("reloading these requests"),g(!0)}),1200)}),[t]),Object(r.useEffect)((()=>{5===n&&2===s&&t.done(!0)}),[t,n,s]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Robust Stream Check"}),Object(i.jsxs)("p",{children:["In this test, we request ",2," URLs that will take a long time (3s) to load."]}),Object(i.jsx)("p",{children:"We will change the URL after 1.2s (when they are still loading), probably bringing a SIGPIPE to your proxy."}),Object(i.jsxs)("p",{children:["Meanwhile, we routinely request ",Object(i.jsx)("code",{children:"/cgi-bin/pingpong"})," and expect the proxy to serve all requests concurrently."]}),Object(i.jsxs)("p",{children:["Status: Ping check ",n," / ",5,". Long request loaded ",s," / ",2,"."]}),Object(i.jsx)("div",{children:j(0,2).map((e=>Object(i.jsx)("iframe",{title:"testing",src:"/cgi-bin/repeater?"+l[u?2+e:e]+",-15,LoremIpsumLoremIpsum,200",...u?{onLoad:n=>function(e,n){t.log("frame "+e+" loaded"),h(t,(()=>{b(n.target.contentDocument,"cannot get loaded document");let e=n.target.contentDocument.body.textContent;b(0===e.indexOf("LoremIpsum"),"bad content: "+e.substr(200)),o((e=>e+1))}))}(e,n),onError:()=>function(e){t.log("frame "+e+" load error","error"),t.done(!1)}(e)}:{onLoad:n=>function(e,n){t.log("frame "+e+" (before URL change) loaded but it should not","error"),h(t,(()=>{b(n.target.contentDocument,"cannot get loaded document"),b("content: "+n.target.contentDocument.body.textContent.substr(200),"debug")})),t.done(!1)}(e,n),onError:()=>function(e){t.log("frame "+e+" (before URL change) load error","error"),t.done(!1)}(e)}},(u?2:0)+e)))})]})},8]];let y={};function w(e){let{result:t}=e,n=0,r=0,c=[];return m.forEach((e=>{let[s,o,i]=e;const l=t.get_status(s);l!==O.Unknown&&r++,l===O.Passed?n++:l===O.Failed&&c.push(t.get_logs(s))})),Object(i.jsxs)("div",{children:[Object(i.jsxs)("h1",{children:["You passed ",Object(i.jsx)("b",{id:"grader-passed-num--DO-NOT-FAKE-THIS-OR-YOU-WILL-GET-SCORE-DEDUCTION",children:n})," tests"," ","out of ",r]}),0===c.length?Object(i.jsx)("p",{children:"Good Job :)"}):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("p",{children:["Note that if your proxy crashes during a test, it fails subsequent tests."," ","Therefore it is recommended to debug the first failure first."]}),Object(i.jsx)("p",{children:'Press "Run" button on the left to re-run a specific test.'})]}),Object(i.jsxs)("div",{id:"grader-log-container",children:[c.length>0&&Object(i.jsx)("p",{children:"Below are logs of failed tests:"}),c.map(((e,t)=>Object(i.jsxs)("div",{children:[Object(i.jsx)("hr",{}),Object(i.jsx)(u,{children:e})]},t)))]})]})}m.forEach(((e,t)=>{let[n,r,c]=e;y[n]={index:t,module:r,timeout:c}}));n(9);function k(){return Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Welcome to Browser TestBench"}),Object(i.jsx)("p",{children:"This testbench will emulate many web application behaviors in your browser."}),Object(i.jsxs)("p",{children:['Set up your proxy, press "Run All Tests" on the left, and see if your proxy can handle them correctly.'," ",'Run a specific test by pressing "Run" next to it.']}),Object(i.jsxs)("p",{children:["You can figure out what HTTP requests are actually made during a test by"," ","inserting appropriate ",Object(i.jsx)("code",{children:"printf"})," in your proxy program."," ","Other tools including the Network tab from your browser's developer tool might also be helpful. "," ","Consult writeup for debugging tips."]}),Object(i.jsx)("p",{children:"We will grade Real Pages score based on number of tests your proxy passes."})]})}var L=function(){let e=Object(r.useRef)({is_auto:!1,fail_fast:!1}),[t,n]=Object(r.useState)((()=>-1===navigator.userAgent.indexOf("proxylab_test_runner"))),[c,s]=Object(r.useState)(null);Object(r.useEffect)((()=>{e.current&&(e.current.fail_fast=t),console.log("update fail fast",e.current)}),[t]),Object(r.useEffect)((()=>{document.title="Browser Testbench"}),[]);let o=function(e){const t=Object(r.useRef)({}),[n,c]=Object(r.useReducer)((()=>+new Date),null);function s(){setTimeout(c,1)}return{clear_stats:()=>{t.current={},s()},get_status:e=>(t.current[e]||{status:O.Unknown}).status,get_logs:e=>(t.current[e]||{logs:["--- no logs ---","debug"]}).logs,start_bench:n=>{const r=d(6);return t.current[n]={status:O.Running,logs:[["[".concat(a(),"] --- Running [").concat(n,"]"),"header"]],runkey:r},{bench_key:n,runkey:r,log:function(e){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";e="[".concat(a()," ").concat(c,"] ").concat(e);let o=t.current[n];o&&o.runkey===r?(console.log("log ".concat(n," (").concat(r,") ").concat(c,": ").concat(e)),o.logs.push([e,c]),s()):console.log("IGNORED to log ".concat(n," (").concat(r,"): ").concat(e))},done:c=>{let o=c?O.Passed:O.Failed,i=t.current[n];i&&i.runkey===r?(console.log("log ".concat(n," (").concat(r,"): ").concat(o)),i.logs.push(["[".concat(a(),"] TEST FINISHED. status = ").concat(o),c?"success":"error"]),i.status=o,i.runkey=null,e(n,o),s()):console.log("IGNORED to update status ".concat(n," (").concat(r,"): ").concat(o))},get_logs:()=>{let e=t.current[n];return e?e.runkey?e.runkey!==r?[["--- test outdated ---","debug"]]:e.logs:e.logs.concat([["--- test stopped ---","debug"]]):[["--- test does not exist ---","debug"]]}}},kill_bench:e=>{let n=t.current[e];n&&n.runkey&&(console.log("KILLED ".concat(e," (").concat(n.runkey,")")),n.runkey=null,n.status===O.Running&&(n.status=O.Unknown),s())}}}((function(t,n){if(console.log("done_callback",e.current,t),e.current.is_auto){if(n===O.Failed&&e.current.fail_fast)return;let r=y[t].index;r<m.length-1?setTimeout((()=>{l(m[r+1][0])}),150):s(null)}}));function l(e){c&&o.kill_bench(c.bench_key);const t=o.start_bench(e);s(t);const n=1e3*y[e].timeout;setTimeout((()=>{t.log("TIMEOUT (".concat(n,"ms), killed"),"error"),t.done(!1)}),n)}let h=null;return c&&(h=y[c.bench_key].module),Object(i.jsxs)("div",{children:[Object(i.jsxs)("div",{className:"ui-sider",children:[Object(i.jsx)("p",{children:Object(i.jsx)("button",{onClick:()=>(e.current.is_auto=!0,o.clear_stats(),void l(m[0][0])),id:"grader-run-btn",children:"Run All Tests"})}),Object(i.jsx)("p",{children:Object(i.jsxs)("label",{children:[Object(i.jsx)("input",{type:"checkbox",checked:t,onChange:e=>n(e.target.checked)}),"\xa0Stop on first failure"]})}),Object(i.jsxs)("table",{border:1,children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{children:"Test"}),Object(i.jsx)("th",{children:"Status"})]})}),Object(i.jsx)("tbody",{children:m.map((t=>{let[n,r,s]=t;return Object(i.jsxs)("tr",{className:c&&c.bench_key===n?"bench-current":"",children:[Object(i.jsx)("td",{children:n}),Object(i.jsxs)("td",{className:"bench-status-"+o.get_status(n),children:[Object(i.jsx)("button",{onClick:()=>{return t=n,e.current.is_auto=!1,void l(t);var t},children:"Run"}),"\xa0",o.get_status(n)]})]},n)}))})]})]}),Object(i.jsx)("div",{className:"ui-main",children:c?Object(i.jsxs)("div",{children:[Object(i.jsx)(h,{bench:c},c.runkey),Object(i.jsx)("hr",{}),Object(i.jsx)(u,{children:c.get_logs()})]}):e.current.is_auto?Object(i.jsx)(w,{result:o}):Object(i.jsx)(k,{})})]})};n(10);class T extends c.a.Component{constructor(e){super(e),this.state={error:null}}static getDerivedStateFromError(e){return{error:e}}render(){return this.state.error?Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"TestBench Error!"}),Object(i.jsx)("p",{children:"Please report this to your TA."}),Object(i.jsx)("p",{id:"grader-passed-num--DO-NOT-FAKE-THIS-OR-YOU-WILL-GET-SCORE-DEDUCTION",style:{color:"white",backgroundColor:"white"},children:"0 "}),Object(i.jsxs)("div",{id:"grader-log-container",children:[Object(i.jsx)("p",{className:"log-line-error",children:Object(i.jsx)("code",{children:""+this.state.error})}),Object(i.jsx)("p",{children:"Stack Trace:"}),Object(i.jsx)("pre",{children:Object(i.jsx)("code",{children:this.state.error.stack||"(not available)"})})]})]}):this.props.children}}o.a.render(Object(i.jsx)(c.a.StrictMode,{children:Object(i.jsx)(T,{children:Object(i.jsx)(L,{})})}),document.getElementById("root"))},9:function(e,t,n){}},[[11,1,2]]]);